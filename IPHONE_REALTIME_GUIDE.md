# 📹 iPhone 實時流檢測使用指南

## 功能說明

實時流檢測功能讓您可以直接拿著 iPhone 攝像頭對準房屋，系統會：
- **每 2 秒自動分析畫面**
- **即時檢測問題**（結構、濕度、管道、電氣等）
- **立即通知**您發現的問題
- **自動記錄**問題到數據庫
- **提供解決建議**

## 🚀 如何使用

### 步驟 1: 訪問應用

在 iPhone 上打開瀏覽器，訪問：
```
http://10.0.0.33:3000
```
（將 `10.0.0.33` 替換為您的 Mac IP 地址）

### 步驟 2: 選擇瀏覽器

**重要：iPhone Safari 不支援實時流媒體！**

請使用以下瀏覽器之一：
- ✅ **Chrome** (推薦)
- ✅ **Edge**
- ❌ **Safari** (不支援)

### 步驟 3: 啟動實時檢測

1. 點擊導航欄中的 **「📹 實時檢測」** 標籤
2. 點擊 **「▶️ 開始實時檢測」** 按鈕
3. 允許瀏覽器訪問攝像頭權限
4. 將 iPhone 對準要檢查的區域

### 步驟 4: 查看檢測結果

- **實時狀態**: 頂部顯示當前分析狀態
- **視頻畫面**: 中間顯示實時攝像頭畫面
- **檢測到的問題**: 下方列表顯示所有檢測到的問題
  - 每個問題包含：
    - 問題類型
    - 嚴重程度（高/中/低）
    - 詳細描述
    - 解決建議
    - 問題截圖
    - 檢測時間

### 步驟 5: 處理問題

- **高優先級問題**: 會立即彈出通知
- **所有問題**: 自動保存到數據庫
- **查看歷史**: 問題會保留在列表中，直到手動清除

## 🔧 技術細節

### 工作原理

1. **視頻流捕獲**: 使用 `getUserMedia` API 獲取攝像頭流
2. **幀提取**: 每 2 秒從視頻流中提取一幀
3. **AI 分析**: 
   - 使用 OpenAI Vision API 分析圖像
   - 結合感應器數據進行綜合分析
   - 檢測結構、濕度、管道、電氣等問題
4. **問題記錄**: 
   - 檢測到問題時立即保存到數據庫
   - 包含問題截圖和詳細信息
5. **即時通知**: 
   - 瀏覽器通知
   - 高優先級問題彈窗提醒

### API 端點

- `POST /api/rag/analyze-realtime-stream` - 分析視頻幀
- `POST /api/issues` - 保存檢測到的問題
- `GET /api/issues` - 獲取所有問題記錄

## ⚠️ 限制和注意事項

### iPhone Safari 限制

iPhone Safari **不支援** `getUserMedia` API，因此無法使用實時流功能。

**解決方案：**
1. 使用 iPhone Chrome 或 Edge 瀏覽器
2. 或使用「📱 iPhone」標籤進行拍照上傳分析

### 網絡要求

- iPhone 和 Mac 必須在同一 WiFi 網絡
- 需要穩定的網絡連接
- 建議使用 5GHz WiFi 以獲得更好的性能

### 性能考慮

- 每 2 秒分析一次，避免過度頻繁
- 圖像分析需要 OpenAI API（需要配置 `OPENAI_API_KEY`）
- 如果沒有 OpenAI API，系統會基於感應器數據進行基本分析

## 💡 使用技巧

1. **光線充足**: 確保檢查區域光線充足，提高檢測準確度
2. **穩定持機**: 保持 iPhone 穩定，避免畫面模糊
3. **多角度檢查**: 從不同角度檢查同一區域
4. **查看建議**: 仔細閱讀每個問題的解決建議
5. **保存記錄**: 所有問題都會自動保存，可以稍後查看

## 🔍 問題排查

### 無法啟動攝像頭
- 檢查瀏覽器權限設置
- 確保使用 Chrome 或 Edge（不是 Safari）
- 檢查網絡連接

### 沒有檢測到問題
- 檢查 OpenAI API 是否配置
- 查看控制台是否有錯誤
- 確認感應器數據是否正常

### 問題沒有保存
- 檢查後端是否運行
- 查看網絡請求是否成功
- 檢查數據庫連接

## 📊 問題記錄格式

每個檢測到的問題包含：
```json
{
  "id": "issue-1234567890-1",
  "timestamp": "2024-01-15T12:00:00Z",
  "type": "高濕度檢測",
  "severity": "high",
  "description": "檢測到高濕度: 75%",
  "recommendation": "建議檢查通風和防水系統",
  "location": "current_inspection_site",
  "image": "data:image/jpeg;base64,..."
}
```

## 🎯 下一步

- 查看所有檢測到的問題：使用 `GET /api/issues` API
- 標記問題為已解決：使用 `PATCH /api/issues/{id}` API
- 導出檢查報告：可以基於問題記錄生成完整報告













